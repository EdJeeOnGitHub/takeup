---
title: |
    | Evidence from a Field Experiment in Kenya
    | The Role of Social Signaling in Community Mass Deworming:
subtitle: "Preliminary Findings -- Do Not Distribute"
date: "March 2017"
author:
- Anne Karing^[University of California Berkeley, `akaring@econ.berkeley.edu`]
- Karim Naguib^[Evidence Action, `karim.naguib@evidenceaction.org`]
output: 
  pdf_document:
    keep_tex: yes
    number_sections: yes
header-includes:
   - \usepackage{pxfonts}
   - \usepackage{bbm}
   - \usepackage{setspace}
   - \usepackage{booktabs}
   - \usepackage[table]{xcolor}
abstract: "This report presents preliminary analysis findings for a randomized control trial (RCT) assessing the effectiveness of social incentives on adult deworming. Working with the Kenyan Government, we implemented a new community deworming program that offered free deworming treatment to adults and explicitly emphasized the public good aspect of deworming. We distributed two types of social incentives in the form of colorful bracelets and ink. The bracelets and ink made the decision to deworm or abstain from treatment observable and allowed adults to signal to others that they contributed to protecting their community from worms. We further introduced a calendar as private incentive that was comparable in its consumption value to the bracelet but could not easily be observed by others. Communities were randomized into being eligible for the ink, calendar or bracelet incentive or a control arm where no incentive was offered. In a second stage, we offered free text messages to a random subset of adults living in these communities, reminding them of the availability of free deworming treatment and providing information about deworming treatment take-up in their community. TODO conclude" 
bibliography: ~/Documents/library.bib
---

<!-- \doublespacing -->

```{r prelim-report-setup, include=FALSE}
library(gridExtra)
library(rgeos)
library(knitr)
library(sp)

read_chunk(purl("takeup_analysis2.Rmd")) #, labels = c("setup", "load-data", "basic-reg-covar", "sms-reg-covar"))

opts_chunk$set(echo = FALSE, cache.path = "takeup_prelim-cache/", fig.path = "takeup_prelim-fig/", fig.align = "center", cache = TRUE)
```


```{r analysis-setup, include=FALSE, ref.label="setup", cache=FALSE}
```

```{r ggplot-theme, cache=FALSE}
# theme_set(theme_bw() +
#             theme(legend.position = "bottom",
#                   strip.background = element_rect(colour = NA), 
#                   panel.border = element_blank())) 
theme_set(theme_minimal() +
            theme(legend.position = "bottom"))
```


```{r load-experiment-design-data}
rct.schools.data <- read_rds(file.path("data", "takeup_rct_schools.rds"))
rct.cluster.selection <- read_rds(file.path("data", "rct_cluster_selection_2.0.rds"))
cluster.strat.data <- read_rds(file.path("data", "takeup_processed_cluster_strat.rds"))

load(file.path("data", "takeup_village_pot_dist.RData"))
```

```{r load-analysis-data, ref.label="load-data"}
```

# Introduction

Over the last decade there has been important progress in the treatment of neglected tropical diseases (NTDs), as a result of unprecedented attention by governments, funders, and the private sector. The enduring prevalence of Soil Transmitted Helminths (STHs), however, still constitutes a massive development burden for both children and adults in many developing countries, including Kenya. Recent efforts to reduce contamination rates in the country have focused on deworming school-aged children, but the remaining reservoir of worms among the adult population fosters reinfection. Epidemiologists have recently postulated that it may be scientifically feasible to reach a transmission breakpoint for STHs [@Anderson2012]. Preventing transmission and eliminating STHs using mass drug administration (MDA) covering the entire population, including children and adults, might be a viable strategy to eliminate worms moving forward. 

This study explores cost-effective ways to achieve high deworming take-up among adults by offering free deworming treatment at central locations and incentives. The evaluation of the incentivized community deworming program relates three separate strands of the literature: compliance with mass drug administration (MDA), incentives and volunatry good contributions. 

Different to previous MDA, this study is focused on deworming treatment at a central location, not through door-to-door visits. @Kremer2011a observe that for preventive and non-acute care such as deworming, insecticide-treated bednet use and water chlorination there is a dramatic drop in demand at non-zero prices. Since a large number of people have such an abrupt cutoff at the same point, they conclude that they are not likely motivated by a simple cost-benefit analysis, but instead have a strong present bias; future benefits are heavily discounted compared to immediate benefits. One approach that has been widely tested and shown to be successful, is to provide a small reward when coming for treatment to offset any inconvenience costs individuals might face, as well as to address present bias. @Kremer2011a review a wide number of studies on the use for incentives to increase education and health service take-up. They find strong evidence in favor of incentives compared to education only interventions.

In this study we focus the program's message on social returns, emphasizing the benefit of taking treatment to reduce reinfection of community members, especially school-aged children. The community deworming program could therefore be viewed as a voluntary collective action game, where an individual's treatment compliance decision can be modeled as the decision to contribute to a pool shared by all community members. One approach to increase contribution in such a setting is to allow for signaling, thus introducing social approval/disapproval as a reward/punishment [@Benabou2006; @Benabou2012a]. Our aim is to test how social signaling can be leveraged to increase demand for deworming treatment among adults, by introducing two signals in the form of colorful ink (similar to that used for voting) and bracelets. Both allow individuals to show to others that they have taken deworming treatment. 

To test the effectiveness of social signals and to investigate the behavioral and social mechanisms driving their influence on deworming take-up, we conducted a cluster randomized trial in western Kenya, stratified over three counties. Our main experimental manipulation was the provision of private incentives (simple wall calendars) and social incentives/signals (voting ink or bracelets).  In addition, we manipulated the distance community members would have to travel to receive deworming treatment; and provided reminders or social information (on peer deworming take-up) using text messaging, randomly assigned to a subset of individuals in each community.

```{r, ref.label="basic-reg-covar"}
```

```{r, ref.label="sms-reg-covar"}
```

```{r basic-ate}
tidy.reg.res <- tidy(reg.output.sms.ctrl.covar) %>% mutate(estimate = estimate * 100)
tidy.reg.res.calendar <- tidy(reg.output.sms.ctrl.calendar.covar) %>% mutate(estimate = estimate * 100)

basic.control.takeup <- tidy.reg.res %>% 
  filter(term == "(intercept)") %$% 
  estimate

basic.calendar.takeup <- tidy.reg.res.calendar %>% 
  filter(term == "(intercept)") %$% 
  estimate

basic.bracelet.takeup <- tidy.reg.res %>% 
  filter(term %in% c("(intercept)", "bracelet")) %$% 
  sum(estimate)

basic.ink.takeup <- tidy.reg.res %>% 
  filter(term %in% c("(intercept)", "ink")) %$% 
  sum(estimate)

bracelet.vs.control.ate <- tidy.reg.res %>% 
  filter(term == "bracelet") %$% 
  estimate

bracelet.vs.calendar.ate <- tidy.reg.res.calendar %>% 
  filter(term == "bracelet") %$% 
  estimate

bracelet.vs.control.pval <- tidy.reg.res %>% 
  filter(term == "bracelet") %$% 
  p.value

bracelet.vs.calendar.pval <- tidy.reg.res.calendar %>% 
  filter(term == "bracelet") %$% 
  p.value
```

```{r sms-ate}
bracelet.sms.res <- linear_tester(reg.output.sms.treat.covar, 
                                  c("social.info + bracelet:social.info + bracelet",
                                    "(intercept) + social.info + bracelet:social.info + bracelet")) %>% 
  mutate(estimate = estimate * 100)

bracelet.sms.vs.control.ate <- bracelet.sms.res[1, "estimate"]
bracelet.sms.vs.control.pval <- bracelet.sms.res[1, "p.value"]

bracelet.sms.takeup <- bracelet.sms.res[2, "estimate"]

phone.owner.control.takeup <- tidy(reg.output.sms.treat.covar) %>% 
  filter(term == "(intercept)") %$% 
  estimate %>% 
  multiply_by(100)
```

Of the three incentive we found the bracelets to be the most effective, with a `r sprintf("%.2f", bracelet.vs.control.ate)` percentage point increase in deworming take-up, compared to the control arm (`r sprintf("%.2f%% vs %.2f%%, $P < %.3f$", basic.bracelet.takeup, basic.control.takeup, bracelet.vs.control.pval)`), a `r sprintf("%.2f", bracelet.vs.control.ate/basic.control.takeup * 100)`% change. When compared to the calendar incentive arm, to control for the private valuation bracelets might have, we found that bracelets increased deworming take-up by `r sprintf("%.2f", bracelet.vs.calendar.ate)` percentage point (`r sprintf("%.2f%% vs %.2f%%, $P < %.3f$", basic.bracelet.takeup, basic.calendar.takeup, bracelet.vs.calendar.pval)`), a `r sprintf("%.2f", bracelet.vs.calendar.ate/basic.calendar.takeup * 100)`% change. Other incentives did not have a statistically significant impact on take-up.

Text messages reporting peer take-up were also found to have a strong impact on deworming take-up, in particular when combined with the bracelet incentives. Take-up in response to bracelet and text messaging treatment increased take-up by `r sprintf("%.2f", bracelet.sms.vs.control.ate)` percentage points when compared to the control arm without text messaging treatment (`r sprintf("%.2f%% vs %.2f%%, $P < %.2e$", bracelet.sms.takeup, phone.owner.control.takeup, bracelet.sms.vs.control.pval)`), a `r sprintf("%.2f", bracelet.sms.vs.control.ate/phone.owner.control.takeup * 100)`% increase.

Based on our preliminary reduced form analysis, we conclude that the use of bracelets as social incentives is a promising instrument to motivate the take-up of health-related behaviors of low private value--but with some social value--such as adult deworming treatment. This is especially true when combined with an informational intervention such as text messages. While this report delves further in how distance affects take-up and how it interacts with the other experimental treatments, and what private value the study's population places on the incentives we are testing, we are not as of yet able to identify the different potential mechanisms influencing take-up. For example, while evidence points to social mechanisms, broadly speaking, as being the main influence, we are not able to distinguish between social learning (receiving information from others), social signaling (broadcasting information to other), or even if our treatments simply function as reminders or "nudges". We will consider these issues elsewhere. 

The remainder of the report is organized as follows: In section \ref{the-intervention} we describe the design of the design of the intervention and the motivation behind it; in section \ref{experiment-design} we describe the design of the experiment; in section \ref{descriptive-statistics} we provide descriptive statistics from the experiment; in section \ref{analysis} we conduct our analysis; and finally, in section \ref{conclusion} we discuss our findings and present our conclusions.

# The Intervention

Working with the Government of Kenya we offered free deworming treatment to adults in 3 counties in western Kenya: Busia, Kakamega and Siaya County. Community Health Volunteers (CHVs) provided the treatment at central locations and sensitized households about the upcoming deworming treatment. CHVs informed all study communities one week prior to the start of the deworming treatment about the social benefits of deworming, when and where free deworming treatment will be available and if applicable what type of incentive will be given to adults when coming for treatment. Pamphlets were handed out to community members and posters were placed in prominent locations. 

Deworming treatment was subsequently offered at central locations, from 8am to 5pm, for a period of 12 days. For logistical reasons, we split deworming treatment into two waves: the first deworming wave was from October 3 to 14 in Busia and Siaya County, and the second wave was from October 24 to November 4 in Kakamega County. Depending on the a cluster's assigned treatment, individuals who came for deworming were either only dewormed or were dewormed and either 

(i) required to receive a mark on their hand using indelible ink as is normally done when voting, 
(ii) given a simple one page wall calendars, with a design unrelated to deworming, as a gift, or
(iii) given a silicon bracelet as a bracelet.

All adults who came to a treatment location were provided with deworming (and applicable incentives/signals) irrespective of where they live; we did not provide treatment only to the communities targeted by the informational campaign^[This was particularly important since nearly half of all clusters' targeted villages were assigned a treatment location in another village.] or require individuals to receive treatment in their home cluster. After treatment, all individuals were asked brief questions by research enumerators.

Central locations were picked to be easy locatable by targeted community members, either in their own villages or in neighboring villages. We initially selected treatment locations to be adjacent to primary schools because of their prominence and ubiquity (more on this below). However, the Ministry of Education did not permit us to operate in such close proximity to schools, so we decided to use alternative locations (such as churches) that are not too far from the originally selected schools^[The Ministry of Education prohibited any social activities within or near primary schools to prevent cheating in exams. During the treatment location survey, we had collected information on backup locations.].

During the informational campaign conducted by CHVs prior to the MDA, we also recruited a random sample of individuals from different households to receive informational text messages about the MDA (see the [Experiment Design](#experiment-design) section). Messages were sent to all recruited subjects a day before the MDA with information on where to find their treatment locations. After that, messages were sent every other day (on the second, fourth, sixth, eight and tenth deworming day). 

CHVs were trained by their supervising Community Health Extension Workers (CHEWs), who also handled the distribution and recovery of deworming drugs. Thus our study was focused on the social aspects of the intervention, e.g., the framing of deworming as a public good and the use of private or social incentives to encourage take-up. We were not involved with the medical aspects of deworming, for which we coordinated with national and local health officials. 

# Experiment Design

We randomly selected 158 clusters in the three study counties, of which 144 were used in the study^[We only intended to use 150 clusters, and only included eight extra clusters as fallback clusters. For various practical reasons, implementation was only possible in 144 clusters.]. We relied on the high geographic density of primary schools in the study counties to select both treatment locations and targeted villages^[Geographic coordinates for primary schools were retrieved from the Kenya Open Data Portal (<http://www.opendata.go.ke/>).]. Each cluster is defined as a treatment location and targeted village pair. We used the location of primary schools as proxies for communities, so that we can identify acceptable locations (i) to set up our treatment locations and (ii) to find villages to target with our informational campaign and data collection.

To pick our clusters from the pool of all primary schools in our study area (a total of 1,451 schools), we used an acceptance-rejection method whereby we randomly picked schools, checked their acceptability based on their overlap with already selected clusters, and if accepted added them to our selected sample. This process was repeated until we had selected the requisite number of clusters. If no acceptable schools remained before completion, the whole process was restarted. Each cluster, centered on its treatment location, had a 2.5 kilometer radius _catchment circle_ and 3-4 kilometer radius _buffer circle_ (buffer sizes were randomly assigned). A cluster was considered acceptable if its _buffer circle_ did not leave any of the already selected clusters' nonoverlapped _catchment circles_ smaller than an a pre-specified size (with about one primary school nonoverlapped).

```{r all-clusters-map, message=FALSE, fig.width=6, fig.height=6, fig.cap="Map of Initial Cluster Selection. Black crosses (+) indicate the selected treatment locations, while the grey regions indicate the nonoverlapped catchment circles from which we selected village(s) to target."}
ggplot.clusters(rct.cluster.selection, include.cluster.ids = FALSE, source = "stamen", maptype = "toner") 
```

After all clusters were selected, we randomly assigned (stratified within counties) each cluster to be either a "close" or "far" cluster: whether its targeted village would be less or more than 1.25 kilometers away from the the treatment location, respectively. We then selected for each cluster, from its nonoverlapping _catchment circle_ and according to its assigned distance treatment, a primary school as an anchor for us to locate its targeted village^[For further details on the cluster selection algorithm refer to the study's pre-analysis plan [@Karing2016].]. Figures \ref{fig:dist-to-pot} and \ref{fig:marginal-dist-to-other-pot} show the distribution of cluster distance to treatment locations and to other clusters. 

Clusters were then randomly assigned, stratified over counties and distance treatment, an incentive/signal treatment: 

(i) Control: no incentives or public signals
(ii) Indelible ink: a mandatory signal of treatment
(iii) Calendar: a private low-value gift 
(iv) Bracelet: a low-value gift and public signal 

To finalize the cluster selection process, we surveyed the treatment location and target village anchor schools. For the treatment locations we confirmed that treatment would be feasible there and identified an alternative treatment locations, not far from the selected schools, as backups. For the anchor schools, we identified all the villages near them. From each cluster's candidate villages we randomly selected a village to target (in some cases because the initial village was too small, we added a second village).

For each village selected for targeting we then conducted a census of all adult community members (18 years of age or older). Enumerators visited all the households in selected villages, captured their geographic coordinates, and filled a roster of all household members, enought to identify them if sampled in later stages and to stratify over relevant characteristics (e.g., phone ownership, relevant for text message treatment).

Using the census lists we drew a number of samples for data collection. All individuals who were in these samples were collectively put the _monitored_ group. At the treatment location, individuals who were treated were asked some quick identifying questions (name, age, etc.), and if they were found to match someone in the _monitored_ group we made a record of their treatment. This is the group for whom we estimate the probability of take-up in our analysis. Except for those in the baseline survey sample, all individuals were not informed about their participation in a study (incomplete disclosure), and therefore we needed to get their reconsent after the study was completed.

### Baseline survey sample {-}

Before the intervention started, we aimed to conduct baseline surveys with 15 individuals (from unique households) per cluster^[The actual number of individuals that were located varied for all the samples.]. The baseline survey questionnaire covered topics such as:

a) Demographics, such as ethnicity, religion, language, age, phone ownership, education, and what material the floors in their homes are made of
b) Knowledge of STH infection, how it is spread and treated, and how individuals' infection status affects others
c) Beliefs about one's own and others' deworming decisions in response to an MDA, and how that decision is affected by others' choices
d) Beliefs about one's own and others' reputation if infected and treated
e) Past experience with deworming treatment

### Text message sample {-}

As described above, in the [Intervention](#the-intervention) section, we recruited individuals to receive informational text messages. We aimed to recruit 30 individiuals per cluster in the control arm and 25 individuals per cluster in the treated arms. In the control arm, we broke the sample into two groups of 15, one received reminder messages only, and the other got reminders and social information -- they were told about the take-up of their community members up to the day of the message^[Peer take-up was described both as "few", "almost half", "almost everyone", etc., and as a "$n$ in 10" proportion.]. In the treated arms, all individuals received social information messages. All text messages recipients were reminded about where the treatment location is.

Naturally, this sample was drawn from the population of phone owners, from which we also drew a comparator "control" sample, not receiving any text messages, and included in the _monitored_ group. We also drew a sample of text message "control" individuals from the non phone owners population. In other words, the sampling of monitored individuals not receiving any text messages was stratified over phone ownership.

### Endline survey sample {-}

After the intervention was concluded, we aimed to conduct endline surveys with the 25 individuals per cluster, selected according to the following schedule:

* From the sample of those not receiving text messages:
    - 15 individuals per cluster in the control arm
    - 20 individuals per cluster in the treated arms
* From the sample of those receiving reminder messages only:
    - 5 individuals per cluster 
* From the sample of those receiving social information messages:
    - 5 individuals per cluster 
   
Since not all individuals responding to the endline survey also responded to the baseline survey, some questions overlapped between the two questionnaires. The endline survey questionnaire covered topics such as:

a) Demographics, such as ethnicity, religion, language, age, phone ownership, education, and what material the floors in their homes are made of
b) Knowledge of STH infection, how it is spread and treated, and how individuals' infection status affects others
c) Knowledge of the MDA intervention: location, start date, and duration of treatment; where respondent got dewormed; how did respondent learn about the MDA; and if they were contacted about a CHV or text messaging
d) Questions testing knowledge of peer deworming: 
    i. Respondents were incentivized to estimate how many of their community members got dewormed.
    ii. Respondents were explicitly asked about their relationship with and their knowledge of deworming status of ten other individuals or pairs of individuals in their community^[We randomly asked respondents about individuals or pairs of individuals, in an effort to overcome potential aversion to disclosing negative information about peers.].
    
All individuals who responded to the endline survey were also asked to reconsent to having their observed take-up status used in our study. The study was explained to them, as well as the reason for not informing about the participation in it prior to the endline survey.

### Reconsent only sample {-}

All remaining individuals in the text message sample (recipients and non-recipients of messages) and who are not in the endline survey sample were visited to to ask for reconsent in the same manner as the endline survey sample. The baseline survey sample was reconsented if they overlapped with any of the other sample. Thus, we were table to observe deworming take-up for a mix of individuals who did and did not respond to a baseline survey.

### Willingness-to-pay survey sample {-}

In order to assess individuals' private valuation of the calendar and bracelet incentives, we conducted willingness-to-pay surveys with a sample of subjects in the control arm who have neither responded to any endline survey nor have they received any text messaging treatment. We randomly selected 25 individuals from each of 24 randomly selected control communities. Respondents were asked to choose one of the two incentives as a gift, revealing their preference. Subsequently, they were offered a random cash amount for them to switch the other incentive, allowing us to estimate the difference in the incentives' price value. 

# Descriptive Statistics 

```{r dist-to-pot, echo=FALSE, fig.width=6, fig.height=4, fig.cap="Distance to Treatment Locations"}
verify.vill.pot.dist %>% 
  select(dist.to.own.pot, closest.other) %>% 
  gather(dist.type, dist) %>% {
  ggplot(.) +
    geom_histogram(aes(dist, fill = dist.type), binwidth = 2500/4, boundary = 0, alpha = 0.5, color = "black", position = "dodge") + 
    scale_x_continuous("", breaks = seq(0, 10000, 2500/4)) + 
    scale_y_continuous("Number of Clusters", breaks = seq(0, 100, 5)) +
    scale_fill_discrete("Distance", labels = c("To Closest Other Treatment Location", "To Assigned Treatment Location")) 
}
```

```{r dist-to-other-pot, fig.width=6, fig.height=4, fig.cap="Distance to Closest Other Point-of-Treatment", eval=FALSE}
verify.vill.pot.dist %>% { 
  ggplot(.) +
    geom_histogram(aes(closest.other), binwidth = 2500/4, boundary = 0, alpha = 0.5, color = "black") + 
    scale_x_continuous("", breaks = seq(0, 10000, 2500/4)) + 
    scale_y_continuous("Number of Clusters", breaks = seq(0, 100, 2)) 
} 
```

```{r marginal-dist-to-other-pot, fig.height=4, fig.width=6, fig.cap="Marginal Distance to Closest Other Treatment Location. Dashed vertical lines indicate the 10th, 25th, 50th, 75th, and 90th percentiles of the distribution."}
verify.vill.pot.dist %>% 
  mutate(marginal.dist = closest.other - dist.to.own.pot,
         dist.to.own.pot.cat = cut(dist.to.own.pot, 
                                   breaks = c(0,  2500/2, 10000),
                                   labels = c("Close", "Far"))) %>% {
  ggplot(.) +
    geom_histogram(aes(marginal.dist), alpha = 0.5, color = "black", binwidth = 500, boundary = 0, position = "dodge") +
    scale_y_continuous("Number of Clusters", breaks = seq(0, 50, 2)) +
    scale_x_continuous("", breaks = seq(-1000, 10000, 1000)) +
     geom_vline(xintercept = quantile(.$marginal.dist, probs = c(0.1, 0.25, .5, 0.75, 0.9)), linetype = "dashed")
}
```

In this section we will present some descriptive statistics and plots, using data collected from the various study surveys. 

```{r cluster-stats}
cluster.stats <- census.data %>%
  filter(!is.na(cluster.id)) %>%
  left_join(select(cluster.strat.data, cluster.id, dist.pot.group), "cluster.id") %>% 
  arrange(county) 

calc.cluster.stats <- . %>% 
  count(county, assigned.treatment) %>% 
  ungroup %>% 
  spread(assigned.treatment, n) %>% { 
    total <- select(., -county) %>% mutate_all(as.numeric) %>% rowSums
    mutate(., all = total) 
  }

# cluster.stats %>% 
#   distinct(cluster.id, .keep_all = TRUE) %>% 
#   calc.cluster.stats %>%
#   list %>% 
#   kable()
# 
# cluster.stats %>% 
#   list(distinct(., cluster.id, .keep_all = TRUE), .) %>% 
#   map(calc.cluster.stats) %>% 
#   kable(booktabs = TRUE)
```

```{r clust-stat-clust, eval=TRUE}
cluster.stats %>% 
  distinct(cluster.id, .keep_all = TRUE) %>% 
  calc.cluster.stats %>%
  set_names(str_to_title(names(.))) %>% 
  list %>% 
  kable(booktabs = TRUE, caption = "Number of clusters by county and treatment arm")
```

```{r clust-stat-individ, eval=TRUE}
cluster.stats %>% 
  calc.cluster.stats %>% 
  set_names(str_to_title(names(.))) %>% 
  list %>% 
  kable(format = "pandoc", booktabs = TRUE, caption = "Number of adults in targeted communities by county and treatment arm", format.args = list(big.mark = ","))
```

By the end of the intervention, we had recorded the deworming treatment of approximately 97,000 individuals. Figure \ref{fig:absolute-takeup} shows how much absolute take-up there was, split by assigned incentive treatment, assigned distance to treatment location, and county. While the pattern of take-up is similar to what we will find in our formal analysis, we are not making any causal argument based on these findings. The aim of this study is to learn about impact on the _proportion_ of take-up in targeted communities, and therefore an analysis based on absolute figures would be misleading as we do not have information of what communities all treated individuals are from.

```{r absolute-takeup, fig.height=6, fig.cap="Absolute Deworming Take-up"}
plot.aggreg.takeup <- function(.data) {
  ggplot(.data, aes(assigned.treatment)) +
    geom_bar(alpha = 0.5, color = alpha("black", 0.5)) +
    labs(x = "Treatment", y = "Number of Individuals Dewormed (x 100)", caption = "Note: range on Y axis varies between counties.") +
    facet_grid(county.randomization ~ dist.pot.group, scales = "free_y", margins = TRUE) +
    scale_y_continuous(labels = . %>% divide_by(100)) + 
    theme(axis.text.x = element_text(angle = 45, hjust = 1))
}

takeup.data %>% 
  mutate_at(vars(dist.pot.group, assigned.treatment), funs(factor(.) %>% fct_relabel(str_to_title))) %>% 
  plot.aggreg.takeup 
```

As descibed in the [Experiment Design](#experiment-design) section, clusters were randomly assigned to be either _close_ or _far_ from the treatment location. Due to small changes in the actual location of treatment and the dispersion of households within targeted areas, actual distances the had the spread seen in Figure \ref{fig:actual-distance}. While there does appear to be some slight overlap or non-compliance with assigned treatment, this should not affect the intention-to-treat analysis carried in this report.

```{r actual-distance, fig.width=8, fig.cap="Distribution of actual distance from targeted villages and their assigned treatment location."}
analysis.data %>%  
  anti_join(outlier.clusters, c("sms.treatment", "cluster.id")) %>% 
  mutate(assigned.treatment = fct_relabel(assigned.treatment, str_to_title)) %>% 
  ggplot(aes(dist.to.pot)) +
  geom_density(aes(color = dist.pot.group, linetype = "Household")) +
  geom_density(aes(color = dist.pot.group, linetype = "Cluster Center"),
               data = mutate(village.centers, assigned.treatment = fct_relabel(assigned.treatment, str_to_title))) +
  geom_vline(xintercept = c(1250), linetype = "dashed") +
  labs(y = "Density", 
       caption = "Cluster centers were calculated as the centroid location of all households in cluster.") +
  scale_x_continuous("Distance to Treatment Location (meters)", breaks = seq(0, 10000, 2500/4)) +
  scale_color_discrete("Cluster Distance Assignment", labels = c("Close", "Far")) +
  scale_linetype_discrete("Distance From") +
  facet_wrap(~ assigned.treatment)
```

Comparing reported knowledge and beliefs of surveyed individuals, the most significant change appears to be the undestanding of who is at risk of worm infection. As shown in Figure \ref{fig:who-at-risk-sth}, there does appear to be an improvement in understanding that all community members are at risk of infection. However, from Figure \ref{fig:infected-infect-others}, it still appears that the predominate belief is that infected individuals cannot infect others.

```{r know-believe-categorical-responses, warning=FALSE, fig.width=8, fig.height=10, fig.cap="Knowledge and beliefs baseline and endline survey responses."}
tribble(~ col.name,      ~ label,
        "who_worms",     "Who is at risk of worms?",
        "effect_worms",  "What are the effects of worms?",
        "spread_worms",  "Can an infected person spread worms to other?",
        "how_spread",    "How are worms spread?",
        "stop_worms",    "How to stop worms?",
        "when_treat",    "When should people get dewormed?",
        "worms_affect",  "If infected, can you affect others' health?",
        "neighbours_worms_affect", "Can neighbors or relatives worm infection affect your health?") %>% 
  multi.know.bel.cat.plot() +
  scale_y_continuous(breaks = seq(0, 1, 0.1)) 
```

```{r response-other-deworm, warning=FALSE, fig.width=8, fig.height=2.5, fig.cap="Reported response to others' deworming choices."}
tribble(~ col.name,      ~ label,
        "few_deworm",     "Deworm if less than half of others deworm?",
        "many_deworm",    "Deworm if more than half of others deworm?",
        "more_less",      "Would you be more likely to deworm if few/many others get dewormed?") %>% 
  multi.know.bel.cat.plot(.endline.data = NULL) +
  scale_y_continuous(breaks = seq(0, 1, 0.1)) 
```

```{r praise-stigma, ref.label="praise-stigma", fig.width=8, fig.height=3, fig.cap="Reported social perception of some observable activities."}
```

```{r dewormed-history, fig.width=8, fig.height=8, fig.cap="Deworming history."}
ever.dewormed.plot <- baseline.data %>% 
  select(treated, family_treated) %>% 
  gather(key = who.treated) %>% 
  mutate(who.treated = if_else(who.treated == "treated", "Self", "Family")) %>% 
  count(who.treated, value) %>% 
  group_by(who.treated) %>% 
  mutate(n = n/sum(n)) %>%
  mutate(value = fct_recode(value, "Don't Know" = "DK") %>% 
             fct_relabel(str_to_title) %>% 
             fct_reorder(n)) %>%
  ungroup %>%
  ggplot(aes(value)) +
  geom_col(aes(y = n), alpha = 0.5) +
  coord_flip() +
  facet_grid(who.treated ~ .) +
  labs(title = "Ever been dewormed before?", x = "", y = "Proportion") +
  theme(strip.text.y = element_text(angle = 0)) 

who.was.dewormed.plot <- baseline.data %>% 
  select(family_treated, who_treated) %>% 
  filter(family_treated == "yes") %>% 
  mutate(who_treated = fct_relabel(factor(who_treated), str_to_title)) %>% 
  ggplot(aes(who_treated)) +
  geom_bar(aes(y = ..count../sum(..count..)), alpha = 0.5) +
  coord_flip() +
  labs(title = "Who in family got dewormed?", x = "", y = "Proportion") +
  theme(strip.text.y = element_text(angle = 0)) 

where.treated.plot <- baseline.data %>% 
  select(treated, family_treated, treated_where, where_family_treated) %>% 
  gather(key = who.treated, value = value, -c(treated, family_treated)) %>% 
  mutate(who.treated = if_else(who.treated == "treated_where", "Self", "Family")) %>% 
  filter((who.treated == "Self" & treated == "yes") | (who.treated == "Family" & family_treated == "yes")) %>% 
  count(who.treated, value) %>% 
  group_by(who.treated) %>% 
  mutate(n = n/sum(n)) %>% 
  ungroup %>% 
  mutate(value = fct_recode(value, "Don't Know" = "DK") %>% 
           fct_relabel(str_to_title) %>% 
           fct_relabel(function(.label) str_replace_all(.label, "Mda", "MDA")) %>% 
           fct_reorder(n)) %>%
  ggplot(aes(value)) +
  geom_col(aes(y = n), alpha = 0.5) +
  coord_flip() +
  facet_grid(who.treated ~ .) +
  labs(title = "Where did you last get dewormed?", x = "", y = "Proportion") +
  theme(strip.text.y = element_text(angle = 0)) 

grid.arrange(ever.dewormed.plot, who.was.dewormed.plot, where.treated.plot)
# ever.dewormed.plot %>% plot
```

```{r know-about-mda, warning=FALSE, fig.width=8, fig.height=4, fig.cap="Knowledge of RCT intervention."}
tribble(~ col.name,      ~ label,
        "know_deworm",    "Know about community-based MDA?",
        "treat_begin",    "Know when MDA starts?",
        "treat_end",      "Know when MDA ends?",
        "days_available", "Know length of MDA?",
        "find_out",       "From whom or how did you learn about the MDA?",
        "chv_visit",      "Did a CHV visit you to tell you about MDA?") %>% 
  multi.know.bel.cat.plot(.baseline.data = NULL) +
  scale_y_continuous(breaks = seq(0, 1, 0.1)) 
```

```{r survey-of-10-beliefs, ref.label="survey-of-10-beliefs", fig.cap="Reported baseline and endline beliefs about others' deworming rate (out of 10)."}
```

```{r baseline-deworming-beliefs, warning=FALSE, fig.width=8, fig.height=4, fig.cap="Baseline Beliefs of others' deworming."}
tribble(~ col.name,      ~ label,
        "dworm_proportion",      "How many people will come to get dewormed?",
        "ink_more_less",         "Will the ink signal increase/decrease deworming take-up?") %>% 
  multi.know.bel.cat.plot(.endline.data = NULL) +
  scale_y_continuous(breaks = seq(0, 1, 0.1)) 
```

```{r reported-gift-pref-deworm, ref.label="reported-gift-pref-deworm", fig.cap="Reported Calendar/Bracelet Preferences, split by experiment arm and respondents' deworming take-up."}
```

```{r first-choice-wtp, ref.label="first-choice-wtp", fig.height=1.5, fig.cap="First choice of incentive in willingness-to-pay survey."}
```

```{r switch-price-wtp, ref.label="switch-price-wtp"}
```


# Analysis


```{r reg-basic-covar-plot, fig.width=8, fig.cap="Plot of regression results comparing incentive/signal treatments."}
prep.sms.ctrl.plot.data(reg.output.sms.ctrl.covar) %>% {
  plot.sms.ctrl.takeup(.) +
    labs(subtitle = "With control")
}

```

```{r basic-reg, ref.label="basic-reg"}
```

```{r dist-reg, ref.label="dist-reg"}
```

```{r dist-reg-covar, ref.label="dist-reg-covar"}
```

```{r dist-reg-covar-plot, fig.width=8, fig.height=7, fig.cap="Plot of regression results comparing incentive/signal treatments with distance from treatment location interactions."}
prep.sms.ctrl.plot.data(reg.output.sms.ctrl.dist.covar, .interact.with = "far") %>% 
  mutate(grp = factor(grp, levels = c("ref.grp", "compare.grp"), labels = c("Close", "Far"))) %>% {
  plot.sms.ctrl.takeup(., .facet.formula = grp ~ ref.treatment) +
    labs(subtitle = "With controls") 
  }

```

```{r reg-tab-data}
reg.table.data <- list("Monitored, No SMS" = reg.output.sms.ctrl, 
                       "Endline, No SMS" = reg.output.sms.ctrl.covar) %>% 
  map_df(function(reg.res) {
    joint.tests.res <- list("Any Treatment" = c("ink", "calendar", "bracelet"),
                            "Signaling Treatment" = c("ink", "bracelet")) %>% 
      map_df(~ linear_tester(reg.res, .x, joint = TRUE), .id = "joint.test.type") %>% 
      select(-starts_with("linear.test")) %>% 
      mutate(joint.test.type = forcats::as_factor(joint.test.type))
    
    tidy(reg.res) %>% 
      bind_rows(control = .,
                calendar = linear_tester(reg.res, c("(intercept) + calendar", "bracelet - calendar")) %>% 
                  mutate(term = c("calendar", "bracelet")),
                .id = "ref.type") %>% 
      mutate(term = fct_recode(factor(term), control = "(intercept)"),
             ref.pt = term == ref.type) %>% 
      list %>% 
      tibble(pt.est = .,
             num.col = n_distinct(.[[1]]$ref.type),
             joint.tests.res = list(joint.tests.res),
             num.obs = length(reg.res$fitted.values),
             num.clusters = length(unique(reg.res$cluster)),
             average.cluster.num.obs = mean(table(reg.res$cluster)),
             r.squared = r_squared(reg.res, adjusted = FALSE),
             adj.r.squared = r_squared(reg.res))
    
  }, .id = "spec") 
 
dist.reg.table.data <- list("Monitored, No SMS" = reg.output.sms.ctrl.dist,
                            "Endline, No SMS" = reg.output.sms.ctrl.dist.covar) %>% 
  map_df(function(reg.res) {
    joint.tests.res <- list("Any Treatment" = c("ink", "calendar", "bracelet", "ink:far", "calendar:far", "bracelet:far"),
                            "Signaling Treatment" = c("ink", "bracelet", "ink:far", "bracelet:far")) %>% 
      map_df(~ linear_tester(reg.res, .x, joint = TRUE), .id = "joint.test.type") %>% 
      select(-starts_with("linear.test")) %>% 
      mutate(joint.test.type = forcats::as_factor(joint.test.type))
    
    tidy(reg.res) %>% 
      bind_rows(control = .,
                calendar = linear_tester(reg.res, c("(intercept) + calendar", "bracelet - calendar")) %>% 
                  mutate(term = c("calendar", "bracelet")),
                # far = linear_tester(reg.res, paste0("(intercept) + far", 
                #                                     c("", " + ink + ink:far", " + calendar + calendar:far", " + bracelet + bracelet:far"))) %>% 
                far = linear_tester(reg.res, c("(intercept) + far",
                                               "ink + ink:far", "calendar + calendar:far", "bracelet + bracelet:far")) %>% 
                  mutate(term = c("far", "ink:far", "calendar:far", "bracelet:far")),
                "calendar:far" = linear_tester(reg.res, c("(intercept) + far + calendar + calendar:far", "bracelet + bracelet:far - calendar - calendar:far")) %>% 
                  mutate(term = c("calendar:far", "bracelet:far")),
                .id = "ref.type") %>% 
      mutate(term = fct_recode(factor(term), control = "(intercept)"),
             ref.pt = term == ref.type) %>% 
      list %>% 
      tibble(pt.est = .,
             num.col = n_distinct(.[[1]]$ref.type),
             joint.tests.res = list(joint.tests.res),
             num.obs = length(reg.res$fitted.values),
             num.clusters = length(unique(reg.res$cluster)),
             average.cluster.num.obs = mean(table(reg.res$cluster)),
             r.squared = r_squared(reg.res, adjusted = FALSE),
             adj.r.squared = r_squared(reg.res))
    
  }, .id = "spec") 
```

```{r basic-reg-table, results="asis"}
pval.stars <- . %>% 
  symnum(cutpoints = c(0, 0.01, 0.05, 0.1, 1), symbols = c("***", "**", "*", ""))

print.reg.table <- function(.reg.table.data) {
  all.pt.est <- .reg.table.data %>% 
    select(spec, num.col, pt.est) %>% 
    mutate(spec = forcats::as_factor(spec)) %>% 
    unnest(pt.est) %>%
    mutate(term = fct_relevel(term, 
                              "bracelet", "calendar", "ink", "control",
                              "bracelet:far", "calendar:far", "ink:far", "far"),
           ref.type =  fct_relevel(forcats::as_factor(ref.type),
                                   "control", "ink", "calendar", "bracelet",
                                   "far", "ink:far", "calendar:far", "bracelet:far")) %>% 
    mutate_at(vars(term, ref.type), 
              funs(fct_relabel(., function(.label) str_replace_all(.label, ":", " ") %>% 
                                 str_to_title %>% 
                                 str_replace_all("\\s+", " $\\\\times$ ")))) %>% 
    right_join(modelr::data_grid(., spec, ref.type, term)) 
  
  total.num.cols <- sum(.reg.table.data$num.col)
 
  cmidrules <- accumulate(.reg.table.data$num.col, ~ last(.x) + c(1, .y), .init = 1) %>% 
    magrittr::extract(-1) %>% 
    map(~ sprintf(" \\cmidrule(r){%d-%d}", .x[1], .x[2])) %>% 
    str_c(collapse = " ") %>% 
    str_c("\\\\\n", collapse = " ") 
  
  cat("\\begin{table}\\centering\n") 
  cat(sprintf("\\begin{tabular}{l*{%d}{c}}\n", total.num.cols))
  cat("\\toprule\n")
  cat(paste(paste(map2(.reg.table.data$pt.est, 
                       seq_len(nrow(.reg.table.data)),
                       ~ sprintf(" & \\multicolumn{%d}{c}{(%d)}", n_distinct(.x$ref.type), .y)), collapse = " "), 
            "\\\\\n", collapse = " "))
  
  cat(paste(.reg.table.data %$% 
              map2(spec, num.col, ~ sprintf("& \\multicolumn{%d}{c}{%s}", .y, .x)) %>% 
              str_c(collapse = " "),
            "\\\\\n", collapse = " "))
  
  cat(cmidrules)
  
  d_ply(all.pt.est, .(term), function(term.rows) {
    term.rows %>% 
      select(ref.pt, estimate, p.value) %>% 
      pmap(function(ref.pt, estimate, p.value) {
        if (is.na(estimate)) {
          return("&")
        } else if (ref.pt) {
          sprintf("& {\\bf %.4f}", estimate)
        } else {
          sprintf("& $%.4f^{%s}$", estimate, pval.stars(p.value))
        }
      }) %>% 
      str_c(collapse = " ") %>% 
      str_c(term.rows$term[1], ., "\\\\\n", collapse = " ") %>% 
      cat
    
    term.rows %$%
      map2(ref.pt, std.error, function(ref.pt, .se) {
        if (is.na(.se) || ref.pt) {
          return("&")
        } else {
          sprintf("& (%.4f)", .se)
        }
      }) %>%
      str_c(collapse = " ") %>% {
        if (!all(coalesce(term.rows$ref.pt, TRUE))) {
          str_c(., "\\\\\n", collapse = " ") 
        } else {
          str_c(., "\n", collapse = " ") 
        } 
      } %>% 
      cat
    
    cat("\\\\\n")
  })
  
  cat(cmidrules)
  
  cat(paste("Observations",  
            .reg.table.data %$% 
              map2(num.obs, num.col, ~ sprintf("& \\multicolumn{%d}{c}{%d}", .y, .x)) %>% 
              str_c(collapse = " "),
            "\\\\\n", collapse = " "))
  
  cat(paste("Mean Obs/Cluster",  
            .reg.table.data %$% 
              map2(average.cluster.num.obs, num.col, ~ sprintf("& \\multicolumn{%d}{c}{%.2f}", .y, .x)) %>% 
              str_c(collapse = " "),
            "\\\\\n", collapse = " "))
  
  cat(paste("Number of Clusters",  
            .reg.table.data %$% 
              map2(num.clusters, num.col, ~ sprintf("& \\multicolumn{%d}{c}{%d}", .y, .x)) %>% 
              str_c(collapse = " "),
            "\\\\\n", collapse = " "))
  
  cat(paste("$R^2$",  
            .reg.table.data %$% 
              map2(r.squared, num.col, ~ sprintf("& \\multicolumn{%d}{c}{%.4f}", .y, .x)) %>% 
              str_c(collapse = " "),
            "\\\\\n", collapse = " "))
  
  cat(paste("$\\text{Adjusted }R^2$",  
            .reg.table.data %$% 
              map2(adj.r.squared, num.col, ~ sprintf("& \\multicolumn{%d}{c}{%.4f}", .y, .x)) %>% 
              str_c(collapse = " "),
            "\\\\\n", collapse = " "))
  
  cat(cmidrules)
 
  cat("\\emph{Joint Hypotheses Tests} & \\\\\n") 
  cat("\\emph{($P$-values)} & \\\\\n") 
 
  linear.tests <- .reg.table.data %>%
    select(spec, num.col, joint.tests.res) %>%
    unnest(joint.tests.res) %>%
    d_ply(.(joint.test.type), 
          . %$% 
            str_c(first(joint.test.type), 
                  str_c(map2(p.value, num.col, ~ sprintf("& \\multicolumn{%d}{c}{%.4f}", .y, .x)), collapse = " "),
                  "\\\\\n",
                  collapse = " ") %>% 
            cat)
  
  cat("\\bottomrule\n")
  cat("\\end{tabular}\n")
  cat("\\end{table}\n")
}

```

```{r tab-test, dependson=c("reg-tab-data", "basic-reg-table"), results="asis"}
print.reg.table(reg.table.data)

print.reg.table(dist.reg.table.data)
```

```{r sms-reg-covar-plot, fig.width=8, fig.height=6, fig.cap="Plot of regreession results comparing incentive/signal treatment with SMS treatment interactions."}
prep.sms.treat.plot.data(reg.output.sms.treat.covar) %>% {
  plot.sms.treat.takeup(.) +
    labs(subtitle = "With Controls") 
} 
```

```{r sms-dist-reg-covar, ref.label="sms-dist-reg-covar"}
```


```{r sms-dist-plot, fig.width=8, fig.height=8, fig.cap="Plot of regression results comparing incentive/signal treatment with SMS and distance from treatment location interactions."}
prep.sms.treat.dist.plot.data(reg.output.sms.treat.dist.covar) %>% {
  plot.sms.treat.takeup(.) +
    facet_grid(dist ~ ., labeller = as_labeller(. %>% paste0("Distance: ", .))) +
    labs(subtitle = "Split by distance to treatment location, with controls")
}
```

## Causal Framework

This section describes the potential outcomes causal framework we will use in this study. Below are the exogenous variables of individuals and clusters ($i$ indexes individuals and $j$ indexes clusters):
 
* $Z_j \in \mathcal{Z} = \{control, ink, calendar, bracelet\}$ is the cluster level treatment
* $M_{ij} \in \mathcal{M} = \{none, reminders, socialinfo\}$ is the individual level text message treatment
* $\mathbf{X}_{ij}$ individual and cluster level pre-treatment characteristics. While we will omit this vector from most of our notation, we will sometimes need to refer to one variable in that vector
  - $P_{ij} \in \{phone, nophone\}$, indicating phone ownership.
  
We describe the set of sampled and monitored individuals as $\mathcal{W}$ and the sub-sample based on phone ownerhship as $\mathcal{Q}(q) = \{i: P_{ij} = q\}$.

Below are the latent intermediate outcomes that influence the decision to get dewormed:

* $V^*_{ij}(z)$, represents the private utility of deworming in response to $z \in \mathcal{Z}$.
* $S^*_{ij}(z, m)$, represents the social influence (in utility terms) of treatment $z \in \mathcal{Z}$ and $m \in \mathcal{M}$ on deworming. 

    This influence combines different mechanisms, thus we can further decompose it into:
    - $R^*_{ij}(z, m)$, a reminder effect
    - $L^*_{ij}(z, m)$, a social learning effect: the effect of receiving information on deworming by observing others' deworming choices
    - $G^*_{ij}(z)$, reputational returns from social signaling
    
    This should also make clear our assumption that text message treatment does not have an effect on $V^*_{ij}$ and $G^*_{ij}$.
    
We represent the binary deworming choice, $Y_{ij} \in \{0, 1\}$, in different ways depending on context

$$
  Y_{ij}(z, m) \equiv Y_{ij}(V^*_{ij}(z), S^*_{ij}(z, m)) \equiv Y_{ij}(V^*_{ij}(z), R^*_{ij}(z, m), L^*_{ij}(z, m), G^*_{ij}(z))
$$

We also represent the total number of individuals dewormed in cluster $j$ in response to treatment $z$, irrespective of these individuals' origins, as $Y^{tot}_j(z)$.

Whenever we reference any of these potential outcomes using one input, this refers to having $m = none$ (e.g., $S^*_{ij}(z) \equiv S^*_{ij}(z, none)$).


## Main Hypotheses {#main-hypo}

First we define the finite sample treatment effect estimators
$$
\begin{aligned}
  \tau[(z, m), (z', m')] &= \sum_{i \in \mathcal{W}} \frac{Y_{ij}(z, m) - Y_{ij}(z', m')}{|\mathcal{W}|} \\
  \tau[(z, m), (z', m'); q] &= \sum_{i \in \mathcal{Q}(q)} \frac{Y_{ij}(z, m) - Y_{ij}(z', m')}{|\mathcal{Q}(q)|}
\end{aligned}
$$
 We can also use the simplified notation $\tau[z,z';q] \equiv \tau[(z, none), (z', none); q]$ and $\tau[z,z'] \equiv \tau[(z, none), (z', none)]$.  

Unless otherwise stated, all estimates will be tested for significance using two-sided hypothesis tests where the null hypothesis is a zero treatment effect. 
$$
  H_0: \tau(\cdot, \cdot) = 0
$$

### Incentive vs. no incentive treatment { #incentive-vs-no-incentive-hypo }

The cluster randomization into different incentive arms allows us to identify the effect that social or private incentives have on deworming take-up, comparing 1 vs. 4, 6 or 8. We will estimate
  
\begin{equation} 
  \tau[ink, control] \equiv \tau[(V^*(ink), S^*(ink)), (V^*(control), S^*(control))]
\end{equation}

If we assume that $V*(control) = V^*(ink)$, this is an estimate of the impact ink's social influence $S^*(ink) - S^*(control)$ on deworming take-up. We will also estimate

\begin{equation}
\tau[bracelet, calendar] \equiv \tau[(V^*(bracelet), S^*(bracelet)), (V^*(calendar), S^*(calendar))]
\end{equation}

If we assume that $V^*(calendar) = V^*(bracelet)$, this is an estimate of the impact bracelets' social influence $S^*(bracelet) - S^*(calendar)$ on deworming take-up.
      
Both these estimates would identify the combined effect of social incentives, $S^*(\cdot)$: 

(a) Acting as reminders, $R^*(\cdot)$, 
(b) Making observable others' deworming decision, $L^*(\cdot)$, and 
(c) Allowing people to signal their decision, $G^*(\cdot)$.

We will also conduct the joint hypothesis test 
\[ H_0: \tau[ink, control] = 0 \land \tau[bracelet, control] = 0 \land \tau[calendar, control] = 0 \] 

### Social vs. no social incentives treatment for text message treatment individuals { #social-incentive-hypo }

Comparing individuals that received reminders and social information text messages in clusters without social incentives to individuals in clusters with social incentives, we identify the effect of social signaling on individuals' deworming decisions. We will estimate

\begin{align} 
  \tau[(ink, none), (control, socialinfo)] \equiv \tau[&(V^*(ink, none), S^*(ink, none)), \\ \nonumber
  &(V^*(control, socialinfo), S^*(control, socialinfo))]
\end{align}

If we assume that $R^*(ink, none) = R^*(control, socialinfo)$ and $L^*(ink, none) = L^*(control, socialinfo)$, this is an estimate of the impact of $G^*(ink) - G^*(control)$ on deworming take-up. We will also estimate

\begin{align} 
  \tau[(bracelet, none), (calendar, socialinfo)] \equiv \tau[&(V^*(bracelet, none), S^*(bracelet, none)), \\ \nonumber
  &(V^*(calendar, socialinfo), S^*(calendar, socialinfo))]
\end{align}
  
If we assume that $R^*(bracelet, none) = R^*(calendar, socialinfo)$, $L^*(bracelet, none) = L^*(calendar, socialinfo)$, and $V^*(calendar) = V^*(bracelet)$ this is an estimate of the impact of $G^*(bracelet) - G^*(calendar)$ on deworming take-up.
    
### No text message treatment vs. text message reminders and social information

Using estimates from \ref{incentive-vs-no-incentive-hypo} where we identified the combined effect of reminders, social learning and social signaling and the comparison from \ref{social-incentive-hypo} where we separately identified social signaling, we can identify the effect of reminders and social learning on deworming take-up. We will estimate

\begin{align}
  \tau[(ink, none), &(control, socialinfo)] - \tau[(ink, none), (control, none)] \equiv \nonumber \\ &\tau[control, socialinfo), (control, none)]
\end{align}
to identify the combined effect of $R^*(ink)$ and $L^*(ink)$ on deworming take-up; and we will estimate
\begin{align}
  \tau[(bracelet, none), &(calendar, socialinfo)] - \tau[(bracelet, none), (calendar, none)] \equiv \nonumber \\ &\tau[(calendar, socialinfo), (calendar, none)]
\end{align}
to identify the combined effect of $R^*(bracelet)$ and $L^*(bracelet)$ on deworming take-up.

### Text message reminder plus social information treatment vs. no text messages for no incentive individuals ###

We will estimate 
\begin{equation}
  \tau[(control, reminders), (control, none)]
\end{equation}
and
\begin{equation}
  \tau[(control, socialinfo), (control, reminders)]
\end{equation}
to identify the effect of reminders and information about others' treatment decisions on deworming take-up. The text message treatments within no incentive clusters allow us to identify the extent to which reminders or social learning are relevant for deworming take-up. 

### Text message treatment with social information vs. no text messages for social incentive individuals

We will estimate
\begin{equation}
  \tau[(ink, socialinfo), (ink, none)]
\end{equation}
and
\begin{equation}
  \tau[(bracelet, socialinfo), (bracelet, none)]
\end{equation}
to identify the additional reminder and social learning effects of text messages in the presence of social incentives. The cross-treatments identify how "satiated" individuals are in terms of being reminded or informed about other people's decision through signals. 

### Calendar/Bracelet Preference Survey
   
During the endline survey, respondents were asked to choose between a calendar or bracelet as a gift for their participation. We will use this to identify the distribution of preference over these two incentives.

First, we define their choice to be 
$$
H_{ij} = \mathbbm{1}\{D^*_{ij} > 0\},
$$ 

where
$$
D^*_{ij} = V^*_{ij}(calendar) - V^*_{ij}(bracelet),
$$
the latent difference in utility between calendars and bracelets. We will estimate this difference from the survey observational data.

## Social Information

As secondary outcome, in addition to deworming take-up, we will look at individuals' beliefs/knowledge about others' deworming decision. Using the information collected in the beliefs section of the endline survey, we will look at whether people know or do not know about others' deworming take-up, whether they are more/less correct about their decisions, whether they are are more/less correct for yes/no answers and make a comparison between social incentive and control individuals. 

## Heterogeneity

We will be investigating heterogeneity of impact on deworming take-up (as described in the [main hypotheses section above](#main-hypo)) based on the following:

1. The village to point-of-treatment distance binary characteristic (discussed in the [Village and Point-of-Treatment Selection] section above).

2. The household to household distance within clusters, creating a density measure per cluster that allows us to investigate if proximity affects the effectiveness of social incentives. 

We will further investigate heterogeneity of impact on individuals' beliefs and knowledge about others' deworming take-up based on the geographic proximity between the individual and others in her village. 

## Temporal Dynamics
Deworming treatment was offered over a period of 12 days. We will look at the distribution of take-up over time comparing social incentive to control clusters. 

## Sample Selection

As described in Section \ref{sampling-identification} our sampling will be stratified based on individuals' phone ownership (collected in the census). A random sample of 25 individuals per clusters were selected in the group without text messaging treatment, $M_{ij} = none$: 17 individuals were selected to be phone owners and 8 were selected to be non phone owners. While this distribution is similar to that observed in the population, we will still need to correct our estimation.

## Inter-cluster Spillover

We will test for the possibility of spillovers or contamination due to cluster proximity. As mentioned in Section \ref{cluster-selection-algorithm} clusters were selected with a geographic buffer between them. However, this is not sufficient guarantee that people would travel farther than we anticipated. Thus we need to test the hypothesis that individuals in our monitored sample have received deworming outside their cluster, and should we fail to reject this hypothesis is sufficient precision we will need to model this spillover in our econometric models.

## Multiple Hypotheses Testing

While we only have a small set of outcomes that we would be analyzing (mainly deworming take-up), there is significant number of treatments (cluster level and individual) we will use to investigate the various behavioral mechanism driving observed behavior. Therefore, we will we correct our inference to account for this.

# Cost-effectiveness

```{r abs-takeup-by-arm}
left_join(takeup.data %>% count(assigned.treatment) %>% rename(abs.takeup = n),
          census.data %>% count(assigned.treatment) %>% rename(census.total = n), "assigned.treatment") %>% 
  mutate(coef = if_else(assigned.treatment == "control", "", levels(assigned.treatment)[assigned.treatment]),
         basic.linear.test = paste("(intercept)", if_else(assigned.treatment == "control", "", sprintf("+ %s", coef))),
         sms.linear.test = paste("(intercept) + social.info", if_else(assigned.treatment == "control", "", sprintf("+ %s + %s:social.info", coef, coef)))) %>% 
  left_join(linear_tester(reg.output.sms.ctrl.covar, .$basic.linear.test), c("basic.linear.test" = "linear.test")) %>% 
  left_join(linear_tester(reg.output.sms.treat.covar, .$sms.linear.test), c("sms.linear.test" = "linear.test"), suffix = c(".non.sms", ".sms")) %>% 
  transmute(assigned.treatment = fct_relabel(assigned.treatment, str_to_title), 
            abs.takeup, census.total, estimate.non.sms, estimate.sms) %>% 
  kable(col.names = c("Arm", "Total Take-up", "Census Population", "Non-SMS-Treated Take-up", "SMS-Treated Take-up"), 
        format.args = list(big.mark = ","), )
```

# Conclusion

# References
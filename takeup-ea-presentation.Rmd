---
title: The Role of Social Signaling in Community Mass Deworming
subtitle: Preliminary Findings from a Field Experiment in Kenya
date: "July 2017"
author:
- Anne Karing (University of California Berkeley)
- Grace Morgan (Evidence Action)
- Karim Naguib (Evidence Action)
    
output: 
  revealjs::revealjs_presentation:
    css: takeup_revealjs.css
---

```{r ea-presentation-setup, include=FALSE}
library(gridExtra)
library(rgeos)
library(knitr)
library(sp)

read_chunk(purl("takeup_analysis2.Rmd")) 

opts_chunk$set(echo = FALSE, cache.path = "takeup-ea-presentation-cache/", fig.path = "takeup-ea-presentation-fig/", fig.align = "center", cache = TRUE)
```

```{r analysis-setup, include=FALSE, ref.label="setup", cache=FALSE}
```

```{r ggplot-theme, cache=FALSE}
theme_set(theme_minimal() +
            theme(legend.position = "bottom"))
```

```{r load-experiment-design-data}
rct.schools.data <- read_rds(file.path("data", "takeup_rct_schools.rds"))
rct.cluster.selection <- read_rds(file.path("data", "rct_cluster_selection_2.0.rds"))
cluster.strat.data <- read_rds(file.path("data", "takeup_processed_cluster_strat.rds"))

load(file.path("data", "takeup_village_pot_dist.RData"))
```

```{r load-analysis-data, ref.label="load-data"}
```

## Presentation Outline

* Introduction
* Experiment
* Results
* Cost-Effectiveness
* Conclusion

# Introduction

## Section Outline

* Motivation
* Background
* Research Questions
* Contribution
* Preview of Findings

## Motivation

* High public valuation and low private valuation
    - Public good game
    - Tragedy of the commons
    - Coordination failure
    - Free-rider problem

* Examples:
    - Mass drug administration (e.g., deworming)
    - Vaccination
    - Blood, marrow, and organ donation
    - Voting
    
## Public Observability

* Pro-social signaling (prestige/shame)
* Conditional cooperation
* Social learning

## Background 

* The TUMIKIA Project: evaluating whether intensifying school- and community-based deworming can eliminate STH infection.

* TakeUp: investigate interventions aimed at increasing the take-up of community-based deworming.
    - Pilot conducted in early 2016
    - Cluster randomized study conducted in the second half of 2016
        - Carried out in Kakamega, Siaya and Busia Counties
        - Conducted over two 12-day waves
        
## Background (continued)

* Interventions investigated in the TakeUp study
    - **Social incentives or signals**
        - Indelible ink
        - Colorful silicon bracelet
    - **Private incentive**
        - Simple paper wall calendar
    - **SMS reminders and information** 

## Research Questions

* What is the impact of social incentives on the take-up of deworming?
    - Distinguish between private and social valuation of incentives
* Is the mechanism driving the impact of social incentives, _social learning_ or _social signaling_?
* How does impact vary within two relevant subgroups
    - Phone vs non phone owners 
    - Distance to point of treatment (randomly assigned)

## Preview of Findings

* Bracelets were found to the most effective incentive (~6pp, ~17% increase in take-up)
    - Impact is driven by social valuation
* Bracelets combined with information on peer take-up: 
    - Had the strongest impact (~29pp, ~80% increase in take-up)
    - Compared to the same informational intervention in the control arm, take-up was higher by ~20pp. This suggests that _reputational_ returns had a strong impact on the decision to deworm (and signal compliance).

# Experiment

## Section Outline
* Candidate Points of Treatment
* Selected Points of Treatment
* Cluster Treatment Assignment
* Targeted Communities
* Distance to Point of Treatment
* Individual Treatment Assignment
* Data Collection
* Monitoring Take-up

## Candidate Points of Treatment

```{r candidate-pot-map, message=FALSE, fig.width=7, fig.height=6, warning=FALSE}
ggplot.clusters(rct.cluster.selection, include.cluster.ids = FALSE, source = "stamen", maptype = "toner", suppress.selected.clusters = TRUE) +
  theme(legend.position = "right")
```

## Selected Points of Treatment (Clusters)

```{r all-selected-pot-map, message=FALSE, fig.width=7, fig.height=6, warning=FALSE}
ggplot.clusters(rct.cluster.selection, include.cluster.ids = FALSE, source = "stamen", maptype = "toner") +
  theme(legend.position = "right")

```

## Cluster Treatment Assignment

* 158 points of treatment were initially selected for the study, of which 14 were dropped.
* Within each county we stratified random cross-cut assignment of 
    - **Incentives**:
        * Control
        * Ink
        * Calendar
        * Bracelet
        
    - **Distances to point of treatment**: 
        * Close 
        * Far

## Targeted Communities

* From each point of treatment's catchment area we randomly selected a community to target according its distance treatment.
* In each target community
    - We conducted an informational campaign
    - Collected census data from which our samples were drawn

## Distance To Point of Treatment

```{r actual-distance, fig.width=6, fig.height=6}
analysis.data %>%  
  mutate(assigned.treatment = fct_relabel(assigned.treatment, str_to_title)) %>%
  ggplot(aes(dist.to.pot)) +
  geom_density(aes(color = dist.pot.group)) +
  # geom_density(aes(color = dist.pot.group, linetype = "Cluster Center"),
  #              data = mutate(village.centers, assigned.treatment = fct_relabel(assigned.treatment, str_to_title))) +
  geom_vline(xintercept = c(1250), linetype = "dashed") +
  scale_y_continuous("Density") +
  scale_x_continuous("Distance to Point of Treatment (meters)", breaks = seq(0, 10000, 2500/4)) +
  scale_color_discrete("Assigned Distance", labels = c("Close", "Far")) +
  scale_linetype_discrete("Distance From") +
  theme(axis.text.y = element_blank())
```

## Individual Treatment Assignment

Phone-owning sub-sample was randomly selected to receive SMS messages:

* **Reminder Only**: recruited individuals received reminder messages every other day during the MDA (15 subjects per incentive control cluster).
* **Social Information**: recruited individuals received information on peer take-up every other day during the MDA (15 subjects per incentive control cluster and 25 subjects per incentive treated cluster). 

```{r phone-own-stats, fig.width=8, fig.height=1, warning=FALSE}
gen.stats.plot <- tribble(~ col.name,       ~ label,
        # "gender",         "Gender",
        # "ethnicity2",      "Ethnicity",
        # "school",         "Schooling",
        # "floor",          "Home floor construction",
        "have_phone",     "Own mobile phone?") %>%
  multi.know.bel.cat.plot(.census.data = census.data %>% mutate(gender = factor(gender, levels = 1:2, labels = c("Male", "Female"))), 
                          .baseline.data = NULL, .endline.data = NULL,
                          preprocess.fun = . %>% mutate(response = fct_relevel(response, rev(levels(baseline.data$school)))),
                          na.rm = TRUE)

plot(gen.stats.plot)
```

## Data Collection

* Census
* Baseline Survey
* Take-up Monitoring
* Endline Survey
* Calendar vs Bracelet Willingness-to-pay Experiment

## Monitoring Take-up

* Monitoring at the point of treatment
* Matching names of dewormed subjects with census data
    - Expanded our sample to ~30,000 (non-SMS treated individuals) compared to ~2,000 in the monitored sample

# Results

## Section Outline
* Absolute Deworming Take-up
* Incentive Treatment Only
* Distance to Point of Treatment
* SMS Treatment
* SMS Treatment and Distance
* Multiple Hypothesis Adjustment

```{r basic-reg, ref.label="unmon-basic-reg", warning=FALSE}
```

```{r dist-reg, ref.label="unmon-dist-reg", warning=FALSE}
```

```{r sms-reg, ref.label="unmon-sms-reg", warning=FALSE}
```

```{r dist-sms-reg, ref.label="unmon-dist-sms-reg", warning=FALSE}
```

## Absolute Deworming Take-up

```{r absolute-takeup, fig.height=6}
plot.aggreg.takeup <- function(.data) {
  ggplot(.data, aes(assigned.treatment)) +
    geom_bar(alpha = 0.5, color = alpha("black", 0.5)) +
    labs(x = "Treatment", y = "Number of Individuals Dewormed (x 100)", caption = "Note: range on Y axis varies between counties.\nNearly 100,000 individuals were dewormed in the study") +
    facet_grid(county.randomization ~ dist.pot.group, scales = "free_y", margins = TRUE) +
    scale_y_continuous(labels = . %>% divide_by(100)) + 
    theme(axis.text.x = element_text(angle = 45, hjust = 1))
}

takeup.data %>% 
  mutate_at(vars(dist.pot.group, assigned.treatment), funs(factor(.) %>% fct_relabel(str_to_title))) %>% 
  plot.aggreg.takeup 
```

## Incentive Treatment Only

```{r basic-reg-plot, fig.width=8}
prep.sms.ctrl.plot.data(restrict.unmon.reg.output.sms.ctrl) %>% 
  plot.sms.ctrl.takeup() 
```

## Distance to Point of Treatment

```{r dist-reg-plot, fig.width=8}
prep.sms.ctrl.plot.data(restrict.unmon.reg.output.sms.ctrl.dist, .interact.with = "far") %>% 
  mutate(grp = factor(grp, levels = c("ref.grp", "compare.grp"), labels = c("Close", "Far"))) %>% 
  plot.sms.ctrl.takeup(.facet.formula = grp ~ ref.treatment) 
```

## SMS Treatment

```{r sms-reg-plot, fig.width=8}
prep.sms.treat.plot.data(restrict.unmon.reg.output.sms.treat) %>%  
  plot.sms.treat.takeup() 
```

## SMS Treatment and Distance

```{r dist-sms-reg-plot, fig.width=8}
prep.sms.treat.dist.plot.data(restrict.unmon.reg.output.sms.treat.dist) %>% 
  plot.sms.treat.takeup() +
  facet_wrap(~ dist) 
```

## Multiple Hypothesis Adjustment (Incentive Only)

```{r mht-ate-plot-1}
mht_between_formatted_filtered_results <- mht_between_formatted_results %>% 
  filter(white_p_value <= 0.1)

mht_plot_formatted_results <- mht_formatted_results %>% 
  mutate(no_sms_compare = sms.treatment_l == "sms.control" & sms.treatment_r == "sms.control") %>% 
  filter(no_sms_compare | white_p_value <= 0.1 | 
           hypo_id %in% c(mht_between_formatted_filtered_results$hypo_id_left, mht_between_formatted_filtered_results$hypo_id_right)) %>% 
  mutate(phone_owner = fct_recode(phone_owner_l, "Phone Owner" = "phone_owner", "Non Phone Owner" = "non_phone_owner"),
         dist.pot.group = fct_relabel(dist.pot.group_l, str_to_title)) %>% 
  mutate_at(vars(starts_with("assigned.treatment")), funs(fct_relabel(., str_to_title))) %>% 
  mutate_at(vars(starts_with("sms.treatment")), funs(fct_recode(., "No SMS" = "sms.control", "Reminder SMS" = "reminder.only", "Social Info SMS" = "social.info"))) %>% 
  mutate(hypo_text = if_else(!no_sms_compare, #phone_owner_l == "phone_owner", 
                             sprintf("%s with %s vs. %s with %s [%d]", assigned.treatment_l, sms.treatment_l, assigned.treatment_r, sms.treatment_r, hypo_id),
                             sprintf("%s vs. %s [%d]", assigned.treatment_l, assigned.treatment_r, hypo_id))) %>% 
  select(phone_owner, dist.pot.group, hypo_text, ends_with("p_value"), hypo_id, estimate, no_sms_compare) %>% 
  gather(p_value_type, p_value, ends_with("p_value")) %>%
  mutate(hypo_text = fct_reorder(hypo_text, hypo_id, .desc = TRUE)) %>% 
  mutate(p_value_type = factor(p_value_type, levels = paste0(c("adj", "unadj", "white"), "_p_value"), c("Adjusted Bootstrap", "Unadjusted Bootstrap", "Unadjusted Cluster Robust"))) 

mht_plotter <- . %>% { 
    ggplot(.) +
      geom_segment(aes(x = hypo_text, xend = hypo_text, y = 0, yend = 1 - p_value, color = p_value_type)) +
      geom_point(aes(hypo_text, 1 - p_value, color = p_value_type), size = 2) +
      geom_text(aes(x = hypo_text, y = 1.1, label = sprintf("%.2f", estimate)), data = . %>% distinct(hypo_id, .keep_all = TRUE)) +
      geom_hline(yintercept = c(0.9, 0.95), linetype = "dotted") +
      scale_y_continuous("1 - p-value", breaks = seq(0, 1, 0.05)) +
      scale_color_discrete("") +
      scale_x_discrete("") +
      coord_flip() +
      theme(legend.position = "bottom") 
}

mht_plot_formatted_results %>% 
  # filter(phone_owner == "Non Phone Owner") %>% 
  filter(no_sms_compare) %>% 
  mht_plotter() + 
  facet_wrap(~ phone_owner + dist.pot.group, scales = "free_y", ncol = 1)
```

## Multiple Hypothesis Adjustment (Interacted with SMS Treatment)

```{r mht-sms-ate, fig.width=8, fig.height=6, message=FALSE}
mht_sms_plot <- mht_plot_formatted_results %>% 
  filter(!no_sms_compare) %>% 
  mht_plotter() + 
  scale_y_continuous("", breaks = seq(0, 1, 0.1)) +
  theme(legend.position = "none") +
  facet_wrap(~ dist.pot.group, scales = "free_y", ncol = 1)

mht_sms_diff_plot <- mht_between_formatted_filtered_results %>% 
  mutate(hypo_text = sprintf("[%d] vs [%d]", hypo_id_left, hypo_id_right)) %>% 
  select(hypo_text, ends_with("p_value"), hypo_id, estimate) %>% 
  gather(p_value_type, p_value, ends_with("p_value")) %>%
  mutate(hypo_text = fct_reorder(hypo_text, hypo_id, .desc = TRUE)) %>% 
  mutate(p_value_type = factor(p_value_type, levels = paste0(c("adj", "unadj", "white"), "_p_value"), c("Adjusted Bootstrap", "Unadjusted Bootstrap", "Unadjusted Cluster Robust"))) %>% 
  ggplot() +
  geom_segment(aes(x = hypo_text, xend = hypo_text, y = 0, yend = 1 - p_value, color = p_value_type)) +
  geom_point(aes(hypo_text, 1 - p_value, color = p_value_type), size = 2) +
  geom_text(aes(x = hypo_text, y = 1.1, label = sprintf("%.2f", estimate)), data = . %>% distinct(hypo_id, .keep_all = TRUE)) +
  geom_hline(yintercept = c(0.9, 0.95), linetype = "dotted") +
  scale_y_continuous("1 - p-value", breaks = seq(0, 1, 0.05)) +
  scale_color_discrete("") +
  scale_x_discrete("") +
  coord_flip() +
  theme(legend.position = "bottom") 

gridExtra::grid.arrange(mht_sms_plot, mht_sms_diff_plot, layout_matrix = matrix(c(1, 1, 1, 1, 1, 2, 2)))
```

# Cost-Effectiveness

## Cost-Effectiveness Analysis

* Conducted a simplified analysis to assess which incentive is the most cost-effective at increasing adult deworming treatment take-up
* Compared the incremental costs of the incentives (bracelets, calendars, and ink) to their relative impacts
* Impact/effect: The percentage increase in deworming treatment take-up achieved from providing the incentive compared to treatment adoption without an incentive

## Cost-Effectiveness Results

Using bracelets as a social incentive is the most cost-effective intervention at increasing take-up in comparison to calendars and ink, at \$141 per % increase in take-up.

Arm         Incremental Unit Cost per Person (USD)   Take-up (%)   Cost Per % Increase in Take-up
--------   ---------------------------------------- ------------- --------------------------------
Ink            \$0.41                                    35%             \$1,475
Calendar       \$0.33                                    38%             \$341
Bracelet       \$0.35                                    46%             \$141

# Conclusion

## Contribution

* The social value of bracelets is higher than their private (consumption) value
* The interaction effect of signaling and information suggests social incentives are not purely informational
    - Individuals have strong reputational concerns
* Social signaling is highly effective in increasing the cooperation in a public good game, and is amplified by better peer information (or reminders)

